!------------------------------------------------------------------------------------
!
!                 Subroutine RK Coefficients
!                 Written by Colton J. Conroy
!                 @ the Isaac Newton Institute
!                           12.12.12
!
!-----------------------------------------------------------------------------------
SUBROUTINE RK_COEFFICIENTS(ORDER,S,NEW)

USE precisions
USE global
IMPLICIT NONE

INTEGER(int_p) :: ORDER, S, PP, SSP1, SSP2, nrk, NEW
REAL(real_p) :: csum
REAL(real_p), DIMENSION(S,S) :: crk
REAL(real_p), ALLOCATABLE :: ATVD(:,:), BTVD(:,:), DTVD(:)

!....Constants

PP = ORDER - 1
SSP1 = S
SSP2 = ORDER

!....Allocate matricies

ALLOCATE(alpha(S,S))
ALLOCATE(beta(S,S))
ALLOCATE(ct(S))

ALLOCATE(ATVD(S,S))
ALLOCATE(BTVD(S,S))
ALLOCATE(DTVD(S))

!....Initialize matricies

alpha = 0.0d0
beta  = 0.0d0
crk   = 0.0d0
ct    = 0.0d0

!....Check input

IF (S < 1 .OR. S > 8) THEN
    PRINT*,'  ****** ERROR!!! Number of stages must be > 1 and < 8 *******'
    PRINT*,'  Execution terminated in subroutine RK_coefficients  '
    STOP
ENDIF

IF (ORDER < 1 .OR. ORDER > 4) THEN
    PRINT*,'  ****** ERROR!!! Order cannot be < 1 or > 4 *******'
    PRINT*,'  Execution terminated in subroutine RK_coefficients  '
    STOP
ENDIF

IF (S < ORDER) THEN
    PRINT*,'  ****** ERROR!!! Stages must be >= order (> for Order 4) *******'
    PRINT*,'  Execution terminated in subroutine RK_coefficients  '
    STOP
ENDIF

IF (ORDER == 4) THEN
    IF (S <= ORDER) THEN
        PRINT*,'  ****** ERROR!!! Stages must be > order for 4th Order *******'
        PRINT*,'  Execution terminated in subroutine RK_coefficients  '
        STOP
    ENDIF
ENDIF

IF (NEW == 1) THEN

    IF (ORDER == 1) THEN
      CFL = 1.0d0/(2.0d0*PP+1.0d0)
      alpha(1,1) = 1.0d0
      beta(1,1)  = 1.0d0
    ENDIF      

    IF ((SSP1.EQ.3).AND.(SSP2.EQ.2)) THEN
        
            NRK = 3
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 0.099308256766310D0
            ATVD(2,2) = 0.900691743233690D0
            ATVD(3,1) = 0.318537560632609D0
            ATVD(3,3) = 0.681462439367391D0
            
            BTVD(1,1) = 0.521093099693580D0
            BTVD(2,2) = 0.469344252350057D0
            BTVD(3,1) = 0.005213666926231D0
            BTVD(3,3) = 0.355105374854702D0
            
    ELSEIF ((SSP1.EQ.4).AND.(SSP2.EQ.2)) THEN
         
            NRK = 4
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.000000000000000D0
            ATVD(2,1) = 0.059418613052739D0
            ATVD(3,1) = 0.162040236890209D0
            ATVD(4,1) = 0.213049467749813D0
            ATVD(2,2) = 0.940581386947261D0
            ATVD(3,2) = 0.000000000000001D0
            ATVD(4,2) = 0.171375745599785D0
            ATVD(3,3) = 0.837959763109790D0
            ATVD(4,4) = 0.615574786650403D0
   
            BTVD(1,1) = 0.396600082220546D0
            BTVD(3,1) = 0.042341962885445D0
            BTVD(4,1) = 0.004443461175963D0
            BTVD(2,2) = 0.373034655398399D0
            BTVD(3,2) = 0.000000000000001D0
            BTVD(4,2) = 0.067967634795482D0
            BTVD(3,3) = 0.332334910946852D0
            BTVD(4,4) = 0.244137010998445D0
            
    ELSEIF ((SSP1.EQ.5).AND.(SSP2.EQ.2)) THEN
         
            NRK = 5
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0

            ATVD(1,1) = 1.000000000000000D0
            ATVD(2,1) = 0.050443378596570D0
            ATVD(3,1) = 0.423050285840291D0
            ATVD(4,1) = 0.053551155948373D0
            ATVD(5,1) = 0.220414081710321D0
            ATVD(2,2) = 0.949556621403430D0
            ATVD(5,2) = 0.000090243705488D0
            ATVD(3,3) = 0.576949714159710D0
            ATVD(4,4) = 0.946448844051627D0
            ATVD(5,5) = 0.779495674584191D0

            BTVD(1,1) = 3.16264691752137D-1
            BTVD(2,2) = 3.00311232169356D-1
            BTVD(3,1) = 1.05127466571023D-1
            BTVD(3,3) = 1.82468823505204D-1
            BTVD(4,1) = 3.6518664289273D-2
            BTVD(4,4) = 2.99328351923154D-1
            BTVD(5,1) = 2.3796996941886D-2
            BTVD(5,2) = 2.8540897699D-5
            BTVD(5,5) = 2.46526959244493D-1
            
    ELSEIF ((SSP1.EQ.6).AND.(SSP2.EQ.2)) THEN

            NRK = 6
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 2.76486751644183D-1
            ATVD(2,2) = 7.23513248355817D-1
            ATVD(3,1) = 9.7984946364171D-2
            ATVD(3,3) = 9.02015053635831D-1
            ATVD(4,1) = 2.59872710659296D-1
            ATVD(4,2) = 7.856020000000001D-9
            ATVD(4,4) = 7.40127281484684D-1
            ATVD(5,1) = 8.7560711616745D-2
            ATVD(5,2) = 6.0713391259179D-2
            ATVD(5,3) = 5.141736418695D-3
            ATVD(5,5) = 8.4658416070538D-1
            ATVD(6,1) = 1.7424655647804D-1
            ATVD(6,2) = 7.0778D-11
            ATVD(6,3) = 6.04526D-9
            ATVD(6,4) = 5.401999866D-6
            ATVD(6,6) = 8.25748035406055D-1
      
            BTVD(1,1) = 2.62807064269699D-1
            BTVD(2,2) = 1.90144392760626D-1
            BTVD(3,1) = 6.9992824632912D-2
            BTVD(3,3) = 2.37055928173108D-1
            BTVD(4,1) = 6.838959780635399D-2
            BTVD(4,2) = 2.064618D-9
            BTVD(4,4) = 1.94510678032903D-1
            BTVD(5,1) = 3.7905872702872D-2
            BTVD(5,2) = 1.5955908118682D-2
            BTVD(5,3) = 1.351284653446D-3
            BTVD(5,5) = 2.22488297932208D-1
            BTVD(6,1) = 1.8749686097568D-2
            BTVD(6,2) = 1.8601D-11
            BTVD(6,3) = 1.588737D-9
            BTVD(6,4) = 1.419683726D-6
            BTVD(6,6) = 2.17012417011537D-1
            
    ELSEIF ((SSP1.EQ.7).AND.(SSP2.EQ.2)) THEN

            NRK = 7
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 8.5997676989D-5
            ATVD(2,2) = 9.99914002323011D-1
            ATVD(3,1) = 3.243699004044D-2
            ATVD(3,3) = 9.6756300995956D-1
            ATVD(4,1) = 1.3583973942284D-2
            ATVD(4,2) = 2.75922050535873D-1
            ATVD(4,4) = 7.10493975521843D-1
            ATVD(5,1) = 2.43475411423557D-1
            ATVD(5,2) = 8.174418516086D-3
            ATVD(5,3) = 1.182963464D-6
            ATVD(5,5) = 7.48348987096893D-1
            ATVD(6,1) = 2.1828984636811D-2
            ATVD(6,2) = 6.7598991294125D-2
            ATVD(6,4) = 1.98272850387789D-1
            ATVD(6,6) = 7.12299173681275D-1
            ATVD(7,1) = 8.455803656946199D-2
            ATVD(7,2) = 1.3632738067068D-2
            ATVD(7,3) = 7.340245076405D-3
            ATVD(7,4) = 1.35057999304014D-1
            ATVD(7,5) = 9.993316295892D-3
            ATVD(7,7) = 7.49417664687159D-1
      
            BTVD(1,1) = 2.26374432502229D-1
            BTVD(2,2) = 2.26354964826904D-1
            BTVD(3,1) = 6.213730480682D-3
            BTVD(3,3) = 2.19031527289744D-1
            BTVD(4,1) = 2.720075254276D-3
            BTVD(4,2) = 6.246169760491D-2
            BTVD(4,4) = 1.6083767050501D-1
            BTVD(5,1) = 2.3562742803953D-2
            BTVD(5,2) = 1.850479352615D-3
            BTVD(5,3) = 2.67792683D-7
            BTVD(5,5) = 1.69407077267677D-1
            BTVD(6,2) = 1.5302683291931D-2
            BTVD(6,4) = 4.4883903987135D-2
            BTVD(6,6) = 1.61246321213905D-1
            BTVD(7,1) = 4.737985600659D-3
            BTVD(7,2) = 3.086103343384D-3
            BTVD(7,3) = 1.661643813598D-3
            BTVD(7,4) = 3.0573677947333D-2
            BTVD(7,5) = 2.262231305298D-3
            BTVD(7,7) = 1.69648998550701D-1
            
    ELSEIF ((SSP1.EQ.8).AND.(SSP2.EQ.2)) THEN

            NRK = 8
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 4.891067780011D-3
            ATVD(2,2) = 9.95108932219989D-1
            ATVD(3,1) = 8.1093621337591D-2
            ATVD(3,3) = 9.18906378662409D-1
            ATVD(4,1) = 2.067896765374D-3
            ATVD(4,2) = 2.26357903879396D-1
            ATVD(4,4) = 7.7157419935523D-1
            ATVD(5,1) = 1.43804042464509D-1
            ATVD(5,2) = 2.24645670502005D-1
            ATVD(5,3) = 1.90754736D-7
            ATVD(5,5) = 6.3155009627875D-1
            ATVD(6,1) = 8.46689053411D-2
            ATVD(6,2) = 1.83257D-9
            ATVD(6,3) = 3.62842D-10
            ATVD(6,6) = 9.15331092463488D-1
            ATVD(7,1) = 2.4897187565872D-2
            ATVD(7,2) = 2.81616938388197D-1
            ATVD(7,3) = 2.2224486434211D-2
            ATVD(7,4) = 1.291291D-9
            ATVD(7,5) = 3.65980959D-7
            ATVD(7,7) = 6.7126102033947D-1
            ATVD(8,1) = 1.13118501196255D-1
            ATVD(8,2) = 1.423038356041D-3
            ATVD(8,4) = 1.127867D-9
            ATVD(8,5) = 2.8943683461359D-2
            ATVD(8,6) = 1.8450513075117D-2
            ATVD(8,8) = 8.38064262783361D-1
      
            BTVD(1,1) = 1.97619905264336D-1
            BTVD(2,2) = 1.96653332913008D-1
            BTVD(3,1) = 1.38261322304259D-1
            BTVD(3,3) = 1.81594191498059D-1
            BTVD(4,1) = 9.0686509528815D-2
            BTVD(4,2) = 4.473282752048D-2
            BTVD(4,4) = 1.52478420180986D-1
            BTVD(5,1) = 9.7907291032652D-2
            BTVD(5,2) = 4.4394456122649D-2
            BTVD(5,3) = 3.7696933D-8
            BTVD(5,5) = 1.24806870196289D-1
            BTVD(6,1) = 9.178414505525D-3
            BTVD(6,2) = 3.62152D-10
            BTVD(6,3) = 7.1705D-11
            BTVD(6,6) = 1.80887643778135D-1
            BTVD(7,1) = 1.1097719275733D-2
            BTVD(7,2) = 5.5653112685108D-2
            BTVD(7,3) = 4.392000903677D-3
            BTVD(7,4) = 2.55185D-10
            BTVD(7,5) = 7.2325123D-8
            BTVD(7,7) = 1.32654539247127D-1
            BTVD(8,1) = 1.2660624562512D-2
            BTVD(8,2) = 2.81220705108D-4
            BTVD(8,4) = 2.22889D-10
            BTVD(8,5) = 5.719847983635D-3
            BTVD(8,6) = 3.646188645983D-3
            BTVD(8,8) = 1.65618180216673D-1
            
    ELSEIF ((SSP1.EQ.4).AND.(SSP2.EQ.3)) THEN
            
            NRK = 4
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 4.97246785739694D-1
            ATVD(2,2) = 5.027532142603059D-1
            ATVD(3,1) = 3.86311870571299D-1
            ATVD(3,3) = 6.13688129428701D-1
            ATVD(4,1) = 3.23034811271828D-1
            ATVD(4,2) = 1.6196425547402D-2
            ATVD(4,4) = 6.6076876318077D-1
      
            BTVD(1,1) = 5.89041045727752D-1
            BTVD(2,2) = 2.96142279070879D-1
            BTVD(3,3) = 3.6148749750939D-1
            BTVD(4,1) = 1.12664801028946D-1
            BTVD(4,2) = 9.540359441493999D-3
            BTVD(4,4) = 3.89219923248234D-1
            
    ELSEIF ((SSP1.EQ.5).AND.(SSP2.EQ.3)) THEN

            NRK = 5
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 2.46364980850805D-1
            ATVD(2,2) = 7.53635019149195D-1
            ATVD(3,1) = 3.71117534702807D-1
            ATVD(3,3) = 6.28882465297193D-1
            ATVD(4,1) = 4.30270405975121D-1
            ATVD(4,2) = 5.687592D-9
            ATVD(4,4) = 5.69729588337289D-1
            ATVD(5,1) = 1.40088797078275D-1
            ATVD(5,2) = 2.09584D-9
            ATVD(5,5) = 8.59911200825884D-1
      
            BTVD(1,1) = 4.05845247402079D-1
            BTVD(2,2) = 3.05859190797476D-1
            BTVD(3,1) = 7.9031725047311D-2
            BTVD(3,3) = 2.55228959715369D-1
            BTVD(4,1) = 5.3493423549296D-2
            BTVD(4,2) = 2.308282D-9
            BTVD(4,4) = 2.31222045731032D-1
            BTVD(5,1) = 5.3948649659203D-2
            BTVD(5,2) = 8.50587D-10
            BTVD(5,5) = 3.48990874043D-1
            
    ELSEIF ((SSP1.EQ.6).AND.(SSP2.EQ.3)) THEN

            NRK = 6

            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 3.12168767243578D-1
            ATVD(2,2) = 6.87831232756422D-1
            ATVD(3,1) = 7.716265806604999D-2
            ATVD(3,3) = 9.2283734193395D-1
            ATVD(4,1) = 4.12132458656463D-1
            ATVD(4,2) = 2.1717224605D-5
            ATVD(4,4) = 5.87845824118932D-1
            ATVD(5,1) = 3.73425049182364D-1
            ATVD(5,2) = 1.62494172731D-3
            ATVD(5,3) = 6.10182039447D-4
            ATVD(5,5) = 6.2433982705088D-1
            ATVD(6,1) = 1.9475670525709D-2
            ATVD(6,2) = 4.280756369499D-3
            ATVD(6,3) = 1.85954886452D-4
            ATVD(6,4) = 4.30495D-10
            ATVD(6,6) = 9.760576177878439D-1
      
            BTVD(1,1) = 3.13661711287779D-1
            BTVD(2,2) = 2.15746321543562D-1
            BTVD(3,1) = 6.5063517563946D-2
            BTVD(3,3) = 2.89458739911268D-1
            BTVD(4,1) = 9.591954428256901D-2
            BTVD(4,2) = 6.811861834D-6
            BTVD(4,4) = 1.84384727166519D-1
            BTVD(5,1) = 3.5438929973665D-2
            BTVD(5,2) = 5.09682002931D-4
            BTVD(5,3) = 1.9139074269D-4
            BTVD(5,5) = 1.95831498577895D-1
            BTVD(6,1) = 2.3383161968088D-2
            BTVD(6,2) = 1.342709368463D-3
            BTVD(6,3) = 5.8326927907D-5
            BTVD(6,4) = 1.3503D-10
            BTVD(6,6) = 3.06151902710808D-1
            
    ELSEIF ((SSP1.EQ.7).AND.(SSP2.EQ.3)) THEN

            NRK = 7

            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 1.47691415319417D-1
            ATVD(2,2) = 8.52308584680583D-1
            ATVD(3,1) = 7.34539305979D-4
            ATVD(3,3) = 9.99265460694021D-1
            ATVD(4,1) = 3.92877396776094D-1
            ATVD(4,2) = 1.47887230450615D-1
            ATVD(4,4) = 4.59235372773291D-1
            ATVD(5,1) = 1.97049996198846D-1
            ATVD(5,2) = 9.368160402672999D-3
            ATVD(5,3) = 8.9935546009991D-2
            ATVD(5,5) = 7.036462973884891D-1
            ATVD(6,1) = 6.1993002028958D-2
            ATVD(6,3) = 6.1395792658554D-2
            ATVD(6,4) = 4.27057986508D-4
            ATVD(6,6) = 8.7618414732598D-1
            ATVD(7,1) = 1.28534993749396D-1
            ATVD(7,3) = 1.053984977328D-2
            ATVD(7,4) = 5.607329238D-6
            ATVD(7,5) = 3.07502271596D-4
            ATVD(7,7) = 8.60612046876491D-1
      
            BTVD(1,1) = 2.580794742818D-1
            BTVD(2,2) = 2.1996335146023D-1
            BTVD(3,1) = 2.319087748D-6
            BTVD(3,3) = 2.57889904763873D-1
            BTVD(4,1) = 4.3608780145257D-2
            BTVD(4,2) = 3.8166658687686D-2
            BTVD(4,4) = 1.18519223576937D-1
            BTVD(5,1) = 7.9389033244D-5
            BTVD(5,2) = 2.41772991171D-3
            BTVD(5,3) = 2.3210518433505D-2
            BTVD(5,5) = 1.81596666510356D-1
            BTVD(6,3) = 1.5844993892434D-2
            BTVD(6,4) = 1.10214900646D-4
            BTVD(6,6) = 2.26125144115936D-1
            BTVD(7,1) = 5.3986013420437D-2
            BTVD(7,3) = 2.720118888497D-3
            BTVD(7,4) = 1.447136582D-6
            BTVD(7,5) = 7.9360024594D-5
            BTVD(7,7) = 2.22106304618468D-1
            
    ELSEIF ((SSP1.EQ.8).AND.(SSP2.EQ.3)) THEN

            NRK = 8

            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 1.452835644833D-3
            ATVD(2,2) = 9.98547164355167D-1
            ATVD(3,1) = 1.5824688647D-4
            ATVD(3,3) = 9.9984175311353D-1
            ATVD(4,1) = 1.35300645522171D-1
            ATVD(4,2) = 4.3910257822658D-2
            ATVD(4,4) = 8.20789096655171D-1
            ATVD(5,1) = 2.5418437348026D-1
            ATVD(5,2) = 2.40296919265655D-1
            ATVD(5,3) = 1.73107225811679D-1
            ATVD(5,5) = 3.32411481442406D-1
            ATVD(6,1) = 6.6883284219592D-2
            ATVD(6,2) = 6.766232631260299D-2
            ATVD(6,3) = 6.265014698872D-3
            ATVD(6,4) = 1.099839887838D-3
            ATVD(6,6) = 8.58089534881095D-1
            ATVD(7,1) = 1.7899811147945D-1
            ATVD(7,2) = 6.1236827D-8
            ATVD(7,3) = 2.0509168546D-4
            ATVD(7,4) = 3.5635846554D-5
            ATVD(7,5) = 1.045577373439D-3
            ATVD(7,7) = 8.197155223782711D-1
            ATVD(8,1) = 1.4239397335328D-2
            ATVD(8,2) = 4.979393069413D-3
            ATVD(8,3) = 4.9618753349D-5
            ATVD(8,4) = 4.08154071557D-4
            ATVD(8,5) = 1.95292343D-7
            ATVD(8,6) = 1.40625581752D-4
            ATVD(8,8) = 9.80182615896259D-1
      
            BTVD(1,1) = 2.19133970894904D-1
            BTVD(2,2) = 2.18815605250994D-1
            BTVD(3,1) = 3.7408889951057D-2
            BTVD(3,3) = 2.1909929362629D-1
            BTVD(4,1) = 3.63333123844D-4
            BTVD(4,2) = 9.622229159698001D-3
            BTVD(4,4) = 1.79862774017288D-1
            BTVD(5,1) = 1.4964409637913D-2
            BTVD(5,2) = 5.2657218112495D-2
            BTVD(5,3) = 3.7933673782714D-2
            BTVD(5,5) = 7.2842647899532D-2
            BTVD(6,1) = 7.217055487D-4
            BTVD(6,2) = 1.4827114244867D-2
            BTVD(6,3) = 1.372877548679D-3
            BTVD(6,4) = 2.4101228197D-4
            BTVD(6,6) = 1.88036567161855D-1
            BTVD(7,1) = 1.4581151700251D-2
            BTVD(7,2) = 1.3419069D-8
            BTVD(7,3) = 4.4942555432D-5
            BTVD(7,4) = 7.809024561999999D-6
            BTVD(7,5) = 2.29121521719D-4
            BTVD(7,7) = 1.79627517422941D-1
            BTVD(8,1) = 2.3565431064376D-2
            BTVD(8,2) = 1.091154175947D-3
            BTVD(8,3) = 1.0873154452D-5
            BTVD(8,4) = 8.9440422437D-5
            BTVD(8,5) = 4.2795187D-8
            BTVD(8,6) = 3.0815842139D-5
            BTVD(8,8) = 2.14791308823501D-1
            
    ELSEIF ((SSP1.EQ.5).AND.(SSP2.EQ.4)) THEN
         
            NRK = 5
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 5.78405168674975D-1
            ATVD(2,2) = 4.21594831325025D-1
            ATVD(3,1) = 6.77678199623741D-1
            ATVD(3,2) = 8.822045619988001D-3
            ATVD(3,3) = 3.13499754756272D-1
            ATVD(4,1) = 3.60703695071165D-1
            ATVD(4,2) = 1.5747555930398D-1
            ATVD(4,3) = 3.40817234398D-4
            ATVD(4,4) = 4.81479928390457D-1
            ATVD(5,1) = 4.03281245556668D-1
            ATVD(5,2) = 1.96797187365244D-1
            ATVD(5,3) = 2.9058018283826D-2
            ATVD(5,4) = 1.46343918738107D-1
            ATVD(5,5) = 2.24519630056155D-1
      
            BTVD(1,1) = 3.63990101160008D-1
            BTVD(2,1) = 2.0871083992052D-2
            BTVD(2,2) = 4.17052806266404D-1
            BTVD(3,1) = 1.745020311D-6
            BTVD(3,2) = 8.727001873487D-3
            BTVD(3,3) = 3.10122285119134D-1
            BTVD(4,1) = 5.820402293450001D-4
            BTVD(4,2) = 1.55779006397411D-1
            BTVD(4,3) = 3.37145461634D-4
            BTVD(4,4) = 4.76292735053434D-1
            BTVD(5,1) = 3.6738984755689D-2
            BTVD(5,2) = 1.94677005403644D-1
            BTVD(5,3) = 2.8744963574915D-2
            BTVD(5,4) = 1.44767291852061D-1
            BTVD(5,5) = 2.22100782124214D-1
            
    ELSEIF ((SSP1.EQ.6).AND.(SSP2.EQ.4)) THEN

            NRK = 6
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 4.67088614334124D-1
            ATVD(2,2) = 5.32911385665876D-1
            ATVD(3,1) = 4.08874458377822D-1
            ATVD(3,3) = 5.91125541622178D-1
            ATVD(4,1) = 4.48601090300132D-1
            ATVD(4,4) = 5.51398909699866D-1
            ATVD(5,1) = 1.12338903697D-4
            ATVD(5,2) = 8.930525958D-6
            ATVD(5,3) = 6.3196058D-8
            ATVD(5,5) = 9.99878667374287D-1
            ATVD(6,1) = 1.32061973305982D-1
            ATVD(6,2) = 1.14804153230642D-1
            ATVD(6,3) = 2.56477290949465D-1
            ATVD(6,4) = 1.16490556977394D-1
            ATVD(6,6) = 3.80166025536516D-1
      
            BTVD(1,1) = 4.42682663664825D-1
            BTVD(2,2) = 2.35910631703883D-1
            BTVD(3,3) = 2.61681029325618D-1
            BTVD(4,1) = 3.46D-13
            BTVD(4,4) = 2.44094738087817D-1
            BTVD(5,1) = 1.0465373390104D-2
            BTVD(5,2) = 3.953389019D-6
            BTVD(5,3) = 2.7975799D-8
            BTVD(5,5) = 4.42628951814885D-1
            BTVD(6,1) = 2.62732028444D-3
            BTVD(6,2) = 5.0821808351925D-2
            BTVD(6,3) = 1.13538050327048D-1
            BTVD(6,4) = 5.1568350054552D-2
            BTVD(6,6) = 1.68292908819375D-1
            
    ELSEIF ((SSP1.EQ.7).AND.(SSP2.EQ.4)) THEN

            NRK = 7
            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 5.25693525536155D-1
            ATVD(2,2) = 4.74306474463845D-1
            ATVD(3,1) = 8.3349916526D-5
            ATVD(3,3) = 9.99916650083474D-1
            ATVD(4,1) = 5.24867751177608D-1
            ATVD(4,2) = 3.69729028192D-4
            ATVD(4,4) = 4.747625197942D-1
            ATVD(5,1) = 1.95877892721119D-1
            ATVD(5,2) = 4.30179D-9
            ATVD(5,3) = 3.855559176D-6
            ATVD(5,5) = 8.04118247417915D-1
            ATVD(6,1) = 6.8982360418487D-2
            ATVD(6,2) = 1.3222295413188D-2
            ATVD(6,3) = 7.59402789052D-4
            ATVD(6,4) = 2.82563389428D-4
            ATVD(6,6) = 9.16753377989845D-1
            ATVD(7,1) = 8.509651769937999D-2
            ATVD(7,2) = 7.019462801832D-3
            ATVD(7,3) = 1.51045322680285D-1
            ATVD(7,4) = 3.15632962717013D-1
            ATVD(7,5) = 2.3712178831159D-2
            ATVD(7,7) = 4.17493555270331D-1
      
            BTVD(1,1) = 3.43396366222189D-1
            BTVD(2,2) = 1.62875119806542D-1
            BTVD(3,1) = 4.313430735199D-3
            BTVD(3,3) = 3.43367744163729D-1
            BTVD(4,1) = 2.490553774367D-3
            BTVD(4,2) = 1.26963604768D-4
            BTVD(4,4) = 1.63031724115818D-1
            BTVD(5,1) = 4.766901826487D-3
            BTVD(5,2) = 1.477219D-9
            BTVD(5,3) = 1.323985011D-6
            BTVD(5,5) = 2.76131284176267D-1
            BTVD(6,1) = 4.2233750546714D-2
            BTVD(6,2) = 4.540488198005D-3
            BTVD(6,3) = 2.60776158259D-4
            BTVD(6,4) = 9.7031241157D-5
            BTVD(6,6) = 3.1480977872363D-1
            BTVD(7,1) = 3.7417046429D-5
            BTVD(7,2) = 2.410458018981D-3
            BTVD(7,3) = 5.1868414943268D-2
            BTVD(7,4) = 1.08387212456966D-1
            BTVD(7,5) = 8.142676045831D-3
            BTVD(7,7) = 1.43365769801014D-1
      
    ELSEIF ((SSP1.EQ.8).AND.(SSP2.EQ.4)) THEN

            NRK = 8

            ATVD(:,:) = 0.D0
            BTVD(:,:) = 0.D0
            DTVD(:) = 0.D0
            
            ATVD(1,1) = 1.0D0
            ATVD(2,1) = 4.61181537109233D-1
            ATVD(2,2) = 5.38818462890767D-1
            ATVD(3,1) = 2.0117158505919D-2
            ATVD(3,3) = 9.79882841494082D-1
            ATVD(4,1) = 1.69428274041103D-1
            ATVD(4,2) = 5.822D-12
            ATVD(4,4) = 8.30571725953071D-1
            ATVD(5,1) = 4.31077025374928D-1
            ATVD(5,2) = 9.6737381267313D-2
            ATVD(5,3) = 8.8663023468039D-2
            ATVD(5,5) = 3.83522569889722D-1
            ATVD(6,1) = 8.9850295244391D-2
            ATVD(6,2) = 5.5129D-11
            ATVD(6,3) = 1.2320078306704D-2
            ATVD(6,4) = 2.95511D-10
            ATVD(6,6) = 8.97829626098266D-1
            ATVD(7,1) = 6.244345604206D-3
            ATVD(7,2) = 4.339895694D-4
            ATVD(7,3) = 3.515550716564D-3
            ATVD(7,4) = 9.393008934879D-3
            ATVD(7,5) = 1.339131D-9
            ATVD(7,7) = 9.8041310383582D-1
            ATVD(8,1) = 7.1188337795849D-2
            ATVD(8,2) = 3.4167417741535D-2
            ATVD(8,3) = 1.632796D-9
            ATVD(8,4) = 2.63316641735748D-1
            ATVD(8,5) = 1.51537858712815D-1
            ATVD(8,6) = 1.14976594D-7
            ATVD(8,8) = 4.79789627404664D-1
      
            BTVD(1,1) = 2.78271529217822D-1
            BTVD(2,2) = 1.4993783763941D-1
            BTVD(3,1) = 1.6659D-11
            BTVD(3,3) = 2.72673496756863D-1
            BTVD(4,1) = 2.4301359D-8
            BTVD(4,2) = 1.62D-12
            BTVD(4,4) = 2.31124464306047D-1
            BTVD(5,1) = 1.267923D-9
            BTVD(5,2) = 2.6919259017783D-2
            BTVD(5,3) = 2.4672395125527D-2
            BTVD(5,5) = 1.06723412012762D-1
            BTVD(6,1) = 3.2744D-11
            BTVD(6,2) = 1.5341D-11
            BTVD(6,3) = 3.42832703049D-3
            BTVD(6,4) = 8.2232D-11
            BTVD(6,6) = 2.4984042303143D-1
            BTVD(7,1) = 3.4914608275757D-2
            BTVD(7,2) = 1.20766941141D-4
            BTVD(7,3) = 9.782776739410001D-4
            BTVD(7,4) = 2.613806960265D-3
            BTVD(7,5) = 3.72642D-10
            BTVD(7,7) = 2.72821053669585D-1
            BTVD(8,1) = 4.265D-11
            BTVD(8,2) = 9.507819584361D-3
            BTVD(8,3) = 4.54361D-10
            BTVD(8,4) = 7.3273524564308D-2
            BTVD(8,5) = 4.2168671678409D-2
            BTVD(8,6) = 3.1994713D-8
            BTVD(8,8) = 1.33511793320745D-1
            
    ENDIF            
            
ELSE

!---------------------------------------------------------------------------------
  IF (ORDER == 1) THEN
!---------------------------------------------------------------------------------
      CFL = 1.0d0/(2.0d0*PP+1.0d0)
      alpha(1,1) = 1.0d0
      beta(1,1)  = 1.0d0
!----------------------------------------------------------------------------------
  ELSEIF (ORDER == 2) THEN
!---------------------------------------------------------------------------------
      
!....2 STAGES

      IF (S == 2) THEN

          CFL = 1.0d0/(2.0d0*PP+1.0d0)
          alpha(1,1) = 1.0d0
          alpha(1,2) = 0.0d0
          alpha(2,1) = 1.0d0/2.0d0
          alpha(2,2) = alpha(2,1)
          beta(1,1)  = 1.0d0
          beta(1,2)  = 0.0d0
          beta(2,1)  = 0.0d0
          beta(2,2) = 1.0d0/2.0d0
       
!....3 STAGES

       ELSEIF (S == 3) THEN

          CFL = 0.590449078021362d0
          alpha(1,1) = 1.000000000000000d0
          alpha(1,2) = 0.000000000000000d0
          alpha(1,3) = 0.000000000000000d0
          alpha(2,1) = 0.087353119859156d0
          alpha(2,2) = 0.912646880140844d0
          alpha(2,3) = 0.000000000000000d0
          alpha(3,1) = 0.344956917166841d0
          alpha(3,2) = 0.000000000000000d0
          alpha(3,3) = 0.655043082833159d0
          beta(1,1)  = 0.528005024856522d0
          beta(1,2)  = 0.000000000000000d0
          beta(1,3)  = 0.000000000000000d0
          beta(2,1)  = 0.000000000000000d0
          beta(2,2)  = 0.481882138633993d0
          beta(2,3)  = 0.000000000000000d0
          beta(3,1)  = 0.022826837460491d0
          beta(3,2)  = 0.000000000000000d0
          beta(3,3)  = 0.345866039233415d0

!....8 STAGES

       ELSEIF(S == 8) THEN

          CFL = 1.711397030610134d0
          alpha(1,1) = 1.000000000000000d0
          alpha(1,2) = 0.000000000000000d0
          alpha(1,3) = 0.000000000000000d0
          alpha(1,4) = 0.000000000000000d0
          alpha(1,5) = 0.000000000000000d0
          alpha(1,6) = 0.000000000000000d0
          alpha(1,7) = 0.000000000000000d0
          alpha(1,8) = 0.000000000000000d0
          alpha(2,1) = 0.000022706789062d0
          alpha(2,2) = 0.999977293210938d0
          alpha(2,3) = 0.000000000000000d0
	  alpha(2,4) = 0.000000000000000d0
	  alpha(2,5) = 0.000000000000000d0
      alpha(2,6) = 0.000000000000000d0
	  alpha(2,7) = 0.000000000000000d0
	  alpha(2,8) = 0.000000000000000d0
	  alpha(3,1) = 0.040163352005589d0
	  alpha(3,2) = -0.000000000000000d0
	  alpha(3,3) = 0.959836647994411d0
	  alpha(3,4) = 0.000000000000000d0
 	  alpha(3,5) = 0.000000000000000d0
	  alpha(3,6) = 0.000000000000000d0
	  alpha(3,7) = 0.000000000000000d0
	  alpha(3,8) = 0.000000000000000d0
	  alpha(4,1) = 0.068277481460787d0
      alpha(4,2) = 0.000794112060878d0
	  alpha(4,3) = -0.000000000000000d0
      alpha(4,4) = 0.930928406478335d0
 	  alpha(4,5) = 0.000000000000000d0
	  alpha(4,6) = 0.000000000000000d0
	  alpha(4,7) = 0.000000000000000d0
	  alpha(4,8) = 0.000000000000000d0
	  alpha(5,1) = 0.203201797047416d0
      alpha(5,2) = 0.049250734246472d0
	  alpha(5,3) = 0.028073821192189d0
	  alpha(5,4) = 0.000000000000000d0
	  alpha(5,5) = 0.719473647513923d0
	  alpha(5,6) = 0.000000000000000d0
	  alpha(5,7) = 0.000000000000000d0
	  alpha(5,8) = 0.000000000000000d0
	  alpha(6,1) = 0.135232895616102d0
	  alpha(6,2) = 0.000233842652217d0
	  alpha(6,3) = 0.057212625463321d0
	  alpha(6,4) = 0.005935142172269d0
	  alpha(6,5) = 0.000000000000000d0
	  alpha(6,6) = 0.801385494096090d0
	  alpha(6,7) = 0.000000000000000d0
	  alpha(6,8) = 0.000000000000000d0
	  alpha(7,1) = 0.330663126197853d0
	  alpha(7,2) = -0.000000000000000d0
	  alpha(7,3) = 0.000000000000000d0
	  alpha(7,4) = 0.036269305920717d0
	  alpha(7,5) = 0.087351183650948d0
	  alpha(7,6) = 0.000000000000000d0
	  alpha(7,7) = 0.545716384230481d0
	  alpha(7,8) = 0.000000000000000d0 	  
	  alpha(8,1) = 0.072377654137843d0
	  alpha(8,2) = 0.001047652272129d0
	  alpha(8,3) = -0.000000000000000d0
	  alpha(8,4) = 0.005351824870836d0
	  alpha(8,5) = 0.206003319412558d0
	  alpha(8,6) = 0.025024389094107d0
	  alpha(8,7) = 0.000000000000000d0
	  alpha(8,8) = 0.690195160212526d0
	  beta(1,1)  = 0.203816348874755d0
	  beta(1,2)  = 0.000000000000000d0
	  beta(1,3)  = 0.000000000000000d0
	  beta(1,4)  = 0.000000000000000d0
	  beta(1,5)  = 0.000000000000000d0
	  beta(1,6)  = 0.000000000000000d0
	  beta(1,7)  = 0.000000000000000d0
	  beta(1,8)  = 0.000000000000000d0
	  beta(2,1)  = 0.000000000000000d0
	  beta(2,2)  = 0.203811720859914d0
	  beta(2,3)  = 0.000000000000000d0
	  beta(2,4)  = 0.000000000000000d0
	  beta(2,5)  = 0.000000000000000d0
	  beta(2,6)  = 0.000000000000000d0
	  beta(2,7)  = 0.000000000000000d0
	  beta(2,8)  = 0.000000000000000d0
	  beta(3,1)  = 0.203690674361979d0
	  beta(3,2)  = -0.000000000000000d0
	  beta(3,3)  = 0.195630401110404d0
	  beta(3,4)  = 0.000000000000000d0
	  beta(3,5)  = 0.000000000000000d0
	  beta(3,6)  = 0.000000000000000d0
	  beta(3,7)  = 0.000000000000000d0
	  beta(3,8)  = 0.000000000000000d0
	  beta(4,1)  = 0.036121835699129d0
	  beta(4,2)  = 0.000161853020846d0
	  beta(4,3)  = -0.000000000000000d0
	  beta(4,4)  = 0.189738428872208d0
	  beta(4,5)  = 0.000000000000000d0
	  beta(4,6)  = 0.000000000000000d0
	  beta(4,7)  = 0.000000000000000d0
	  beta(4,8)  = 0.000000000000000d0
	  beta(5,1)  = 0.084801239646524d0
	  beta(5,2)  = 0.010038104833517d0
	  beta(5,3)  = 0.005721903734355d0
	  beta(5,4)  = 0.000000000000000d0
	  beta(5,5)  = 0.146640491947890d0
	  beta(5,6)  = 0.000000000000000d0
	  beta(5,7)  = 0.000000000000000d0
	  beta(5,8)  = 0.000000000000000d0
	  beta(6,1)  = -0.000000000000000d0
	  beta(6,2)  =  0.000047660955586d0
	  beta(6,3)  = 0.011660868431473d0
	  beta(6,4)  = 0.001209679007605d0
	  beta(6,5)  = 0.000000000000000d0
	  beta(6,6)  = 0.163335465447857d0
	  beta(6,7)  = 0.000000000000000d0
	  beta(6,8)  = 0.000000000000000d0
	  beta(7,1)  = 0.058391312304979d0
	  beta(7,2)  = -0.000000000000000d0
	  beta(7,3)  = 0.000000000000000d0
	  beta(7,4)  = 0.007392277508982d0
	  beta(7,5)  = 0.017803599321625d0
	  beta(7,6)  = 0.000000000000000d0
	  beta(7,7)  = 0.111225920954990d0
	  beta(7,8)  = 0.000000000000000d0
	  beta(8,1)  = 0.004977697629959d0
	  beta(8,2)  = 0.000213528660996d0
	  beta(8,3)  = -0.000000000000000d0
	  beta(8,4)  = 0.001090789404991d0
	  beta(8,5)  = 0.041986844418748d0
	  beta(8,6)  = 0.005100379617982d0
	  beta(8,7)  = 0.000000000000000d0
	  beta(8,8)  = 0.140673057565544d0
     
      ENDIF

!----------------------------------------------------------------------------------
  ELSEIF (ORDER == 3) THEN
!---------------------------------------------------------------------------------- 
 
!....3 STAGES

      IF (S == 3) THEN
	  CFL = 1.0d0/(2.0d0*PP+1.0d0)	
      alpha(1,1) = 1.000000000000000d0
	  alpha(1,2) = 0.000000000000000d0
	  alpha(1,3) = 0.000000000000000d0
	  alpha(2,1) = 0.750000000000000d0
	  alpha(2,2) = 0.250000000000000d0
	  alpha(2,3) = 0.000000000000000d0
	  alpha(3,1) = 0.333333333333333d0
	  alpha(3,2) = 0.000000000000000d0
	  alpha(3,3) = 0.666666666666667d0
	  beta(1,1)  = 1.000000000000000d0
	  beta(1,2)  = 0.000000000000000d0
	  beta(1,3)  = 0.000000000000000d0
	  beta(2,1)  = 0.000000000000000d0
	  beta(2,2)  = 0.250000000000000d0
	  beta(2,3)  = 0.000000000000000d0
	  beta(3,1)  = 0.000000000000000d0
	  beta(3,2)  = 0.000000000000000d0
	  beta(3,3)  = 0.666666666666667d0

      ELSEIF (S == 8) THEN


      ENDIF

!------------------------------------------------------------------------------
  ELSEIF (ORDER == 4) THEN
!-------------------------------------------------------------------------------

!....5 Stages (there is no 4th order 4 stage method)

      IF (S == 5) THEN
          
	  CFL = 0.220062927988164d0
      alpha(1,1) = 1.000000000000000d0
	  alpha(1,2) = 0.000000000000000d0
	  alpha(1,3) = 0.000000000000000d0
	  alpha(1,4) = 0.000000000000000d0
	  alpha(1,5) = 0.000000000000000d0
	  alpha(2,1) = 0.261216512493821d0
	  alpha(2,2) = 0.738783487506179d0
 	  alpha(2,3) = 0.000000000000000d0  
	  alpha(2,4) = 0.000000000000000d0
	  alpha(2,5) = 0.000000000000000d0
	  alpha(3,1) = 0.623613752757655d0
	  alpha(3,2) = 0.000000000000000d0
	  alpha(3,3) = 0.376386247242345d0
	  alpha(3,4) = 0.000000000000000d0
	  alpha(3,5) = 0.000000000000000d0
	  alpha(4,1) = 0.444745181201454d0
	  alpha(4,2) = 0.120932584902288d0
	  alpha(4,3) = 0.000000000000000d0
	  alpha(4,4) = 0.434322233896258d0
	  alpha(4,5) = 0.000000000000000d0
	  alpha(5,1) = 0.213357715199957d0
	  alpha(5,2) = 0.209928473023448d0
	  alpha(5,3) = 0.063353148180384d0 
	  alpha(5,4) = -0.000000000000000d0
	  alpha(5,5) = 0.513360663596212d0
	  beta(1,1)  = 0.605491839566400d0
	  beta(1,2)  = 0.000000000000000d0
	  beta(1,3)  = 0.000000000000000d0
	  beta(1,4)  = 0.000000000000000d0
	  beta(1,5)  = 0.000000000000000d0
	  beta(2,1)  = 0.000000000000000d0
	  beta(2,2)  = 0.447327372891397d0
	  beta(2,3)  = 0.000000000000000d0
	  beta(2,4)  = 0.000000000000000d0
	  beta(2,5)  = 0.000000000000000d0
	  beta(3,1)  = 0.000000844149769d0
	  beta(3,2)  = 0.000000000000000d0
	  beta(3,3)  = 0.227898801230261d0
	  beta(3,4)  = 0.000000000000000d0
	  beta(3,5)  = 0.000000000000000d0
	  beta(4,1)  = 0.002856233144485d0
	  beta(4,2)  = 0.073223693296006d0
	  beta(4,3)  = 0.000000000000000d0
	  beta(4,4)  = 0.262978568366434d0
	  beta(4,5)  = 0.000000000000000d0
	  beta(5,1)  = 0.002362549760441d0
	  beta(5,2)  = 0.127109977308333d0 
	  beta(5,3)  = 0.038359814234063d0
	  beta(5,4)  = -0.000000000000000d0
	  beta(5,5)  = 0.310835692561898d0 

      ENDIF
 
   ENDIF
   
ENDIF   

IF (order > 1) THEN
    alpha = ATVD
    beta  = BTVD
ENDIF

IF (debug == 4) THEN
    DO j = 1, S
        write(*,*)beta(:,j)
	write(*,*)'-------'
    ENDDO
ENDIF

!....ct coefficients for exact solution in time

DO i = 0, S-1
    DO j = 1, S
	csum = 0.0d0
	DO ii = i+1, j-1
	    csum = csum + crk(ii,i+1)*alpha(j,ii+1)
	ENDDO
	crk(j,i+1) = beta(j,i+1) + csum
    ENDDO
ENDDO

DO i = 1, S-1
    ct(i+1) = 0.0d0
    DO j = 0, i-1
        ct(i+1) = ct(i+1) + crk(i,j+1)
    ENDDO
ENDDO

IF (debug == 4) THEN
	write(*,*)ct
ENDIF
 
RETURN
END SUBROUTINE RK_COEFFICIENTS